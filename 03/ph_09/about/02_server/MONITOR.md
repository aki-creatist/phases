# システムの監視

## topコマンドの出力結果

```text
  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                                                                                                                                                                                                   
top - 12:17:36 up 3 days, 10:25,  0 users,  load average: 0.12, 0.08, 0.02
top - 12:23:09 up 3 days, 10:31,  0 users,  load average: 0.19, 0.08, 0.01
Tasks:  16 total,   1 running,  15 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.3 us,  0.0 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem:   2046976 total,  1793792 used,   253184 free,    70752 buffers
KiB Swap:  1048572 total,      308 used,  1048264 free.  1219584 cached Mem
```

* ロードアベレージ
    * システム負荷の平均値
        * 実行待ちとなっているプロセス
            * 実行可能だけどCPUが他の処理をしているために
            * 順番待ちのイメージ
    * CPU数(コア数)以下であれば問題ない
        * 2コアのCPUを2つ搭載している場合の目安は4.0以下であること

### １行目は基本情報

| 項目1 | 項目2 | 項目3 | 項目4 |
|:----|:----|:----|:----|
| - 12:00:57 up 3 days, | 10:08, | 0 users, | load average: 0.00, 0.02, 0.04 |
| 現在時刻 | システムが起動してからの時間 | ログインユーザ数 | ロードアベレージ |

```text
Tasks:  14 total,   1 running,  13 sleeping,   0 stopped,   0 zombie
```

### ２行目は実行中のプロセス

| 項目1 | 項目2 | 項目3 | 項目4 | 項目5 |
|:----|:----|:----|:----|:----|
| Tasks:  14 total, | 1 running, | 13 sleeping, | 0 stopped, | 0 zombie |

### 3行目はCPUの負荷状況

| 項目1 | 項目2 | 項目3 | 項目4 | 項目5 | 項目6 | 項目7 |
|:----|:----|:----|:----|:----|:----|:----|
| %Cpu(s):  0.0 us, | 0.0 sy, | 0.0 ni,100.0 id, | 0.0 wa, | 0.0 hi, | 0.0 si, | 0.0 st |

### 4行目はメモリについて

| 項目1 | 項目2 | 項目3 | 項目4 |
|:----|:----|:----|:----|
| KiB Mem:   2046976 total, | 1793576 used, | 253400 free, | 70752 buffers |

### 5行目はスワップについて

| 項目1 | 項目2 | 項目3 |
|:----|:----|:----|
| KiB Swap:  1048572 total, | 308 used, | 1048264 free.  1219580 cached Mem |

## dfコマンドの出力結果

| 項目1 | 項目2 | 項目3 | 項目4 | 項目5 | 項目6 |
|:----|:----|:----|:----|:----|:----|
| Filesystem | 1K-blocks | Used | Available | Use% | Mounted on |
| ファイルシステム | サイズ | 使用 | 残り | 使用% | マウント位置 |

* 下記の出力結果の見方の例
    * /ディレクトリは

```text
Filesystem     1K-blocks      Used Available Use% Mounted on
overlay         65792556  16617724  45803056  27% /
tmpfs              65536         0     65536   0% /dev
tmpfs            1023488         0   1023488   0% /sys/fs/cgroup
osxfs          488245288 216871192 266501636  45% /var/www
/dev/sda1       65792556  16617724  45803056  27% /etc/hosts
shm                65536         0     65536   0% /dev/shm
tmpfs            1023488         0   1023488   0% /proc/scsi
tmpfs            1023488         0   1023488   0% /sys/firmware
```

## freeコマンドの実行結果

```text
             total       used       free     shared    buffers     cached
Mem:       2046976    1794136     252840       4876      70752    1219724
-/+ buffers/cache:     503660    1543316
Swap:      1048572        308    1048264
```

* １行目: メモリの状況
* ２行目: バッファ・キャッシュを引いた値
* ３行目: スワップの状況
* Linuxは、空きメモリがあると、ハードディスクへのアクセスを高速化するため、メモリの一部を利用する
    * バッファ・キャッシュという
    * 実際に使われているメモリは、バッファ・キャッシュの値を差し引いた、２行目をみる必要がある
* メモリが不足すると、Linuxは一時的にディスクの一部を仮想メモリとして利用する
    * スワップという
    * スワップが日常的に発生しているようなら、メモリの増設が必要

### Mem

* 読み方
    * 「トータル○○Mバイトのメモリのうち、○○Mバイトが使われていて、○○Mバイトが空きメモリ」

| total | used | free | shared | buffers | chached |
|:----|:----|:----|:----|:----|:----|
| 全メモリの合計 | 使用中のメモリ | 空きメモリ | 未使用 | バッファ | キャッシュ |

### +/- buffers/cache

実際に使われているメモリと空きメモリ

| used | free |
|:----|:----|
| バッファ・キャッシュ以外に使われているメモリ | バッファ・キャッシュも含めた空きメモリ |

### swap

| total | used | free |
|:----|:----|:----|
| スワップ領域の合計 | 使用中のスワップ領域 | 空きスワップ領域 |
