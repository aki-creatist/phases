# データアクセス(１テーブル検索)

今度は`ID`を指定して、そのデータを取得する

![cake3_0015.png](image/cake3_0015.png)

## 検索用フォームを用意する

DBは、必要に応じて的確にデータを取り出せてこそ役に立つ

* そのために不可欠なのが`検索`の機能
* CakePHPには、検索に関する機能が一通り用意されており、様々な形でデータを取得することが可能

まずは、検索機能を利用するためのテンプレートを用意
`find.ctp`というファイルを作成し、下記のように記述

[src/Template/Persons/find.ctp](find.cpt)

このテンプレートを利用する形で、検索の処理を作成

## IDで単純検索 read()

* DBアクセスの基本は、`ID`を指定して、そのデータを取得する方法
* そのためのメソッドがread()

```php
read (【取得したい項目：配列】, 【id:数値】)
```

* `取得したい項目名`に`null`をセット
    * `当該レコード`の全項目を取得する
* 例: `会議室コントローラ`内で、`view()アクション`に下記の1行を追加

```php
//app¥Controller¥MeetingRoomsController.php
debug ($this->MeetingRoom->read(null, $id));
```

* この状態で`会議室一覧`画面の任意のデータの`View`をクリックすると、`検索結果`が下記のように表示される
    * 変数の中に`Meeting`という`空っぽの配列`もある
    * これは、`会議室モデル`で関連を定義しているので、`会議室レコード`と一緒に`会議`(Meeting)も検索している
    * `サンプルサイト`で、この`会議室`に紐づく`会議データ`も登録していれば、その`会議室データ`も一緒に検索可能


## レコードの絞り込み条件の設定

* 全レコードをエンティティ配列として取り出すもの
    * `find('all')`にはすでに触れた通り

```php
//find('all')の復習
$this->Persons->find('all')
```

* `find`
    * 検索の基本となるものindexでは引数に'all'を指定した
    * 引数なしで使うと、一般的な検索を行うためのメソッドとして機能する
    * `Query`というクラスのインスタンスが返値
    * Queryは、検索のための設定を管理するクラス
    * このQueryにあるメソッドを呼び出すことで、検索の条件などを指定可能
    * `Query`を作成して細かな検索の条件を設定していく仕組みはCakePHP3に搭載されている`Query Builder`と呼ばれるもの
    * ポイントは、`Query`を使って、`いかにして検索に関する設定を追加していくか`