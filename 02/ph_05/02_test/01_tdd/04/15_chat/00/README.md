# 概要

## 仕様

* 2つのビューを持つ
* アプリケーション起動時には、希望のユーザー名を入力するためのフォームを表示
* フォームをサブミットすると、フォームの表示は消える
    * 同時にメッセージのリストと新しいメッセージを入力するためのフォームが表示する

## ディレクトリ構造

* JsTestDriverを使ってテストを実行する
* TDDセッションでは、依存ファイルの一部はスタブ化する
    * スタブ化によりクライアントはそのファイルを使わずに開発可能

```text
.
|-- lib
|   |-- stub.js
|   '-- tdd.js
|-- src
'-- test
```

## アプローチを選ぶ

* クライアントの構築方法について全般的な考え方を決める
    * DOMとデータを明確に分離から行う
    * すべての依存ファイルを外から、依存ファイル注入を使ってコントロールする
    * これを実現するためには、MVPデザインパターンを使用する
        * MVP: モデル/ビュー/プレゼンタ
            * 単体テストしやすく、テスト駆動開発に非常に向いている

### パッシブビュー

* このモデルの概要
    * ビューがプレゼンタにユーザー入力のことを通知する
    * コントローラがビューの状態を完全に管理する
        * コントローラは、ビューのイベントに応答し、その下のモデルを操作する
        * ブラウザ環境では、DOMがビューにあたる
* チャットアプリケーションでは、モデルはcometClientオブジェクトから提供される
* メインの仕事はコントローラの開発になる
    * コントローラは複数形
    * コントローラは多数ある
* 個々のウィジェット、さらにはウィジェットのコンポーネントは、独立したビューとコントローラで表現する
    * これは`MVPアクシス`と呼ばれることもある
    * 個々のオブジェクトが1つの明確な仕事を持つため、単一責任の原則には従いやすい
* コンポーネント
    * ここでは`コントローラ/ビューの組合せ`のこと

### チャットクライアントの構成は以下

* ３つのコンポーネントに分割する
    * ユーザーフォーム
    * メッセージリスト
        * ユーザーフォームの処理が成功時に表示
    * メッセージフォーム
        * ユーザーフォームの処理が成功時に表示
        
### フロー
   
* コントローラからはほかのコントローラのことが分からない
* そのためこのフローは外部から制御する
* コントローラを完全に切り離すことの意味
    * コンポーネントを追加、削除することによってクライアントを簡単に操作可能
        * その分クライアントのテストもしやすくなる

### クライアントの表示

* コンポーネントを表示するためにはDOM要素が必要
    * アプリケーション用のHTML作成
* まともな用途のないコントロールをユーザーに見せないようにする
    * 最初はチャット関連のすべてのマークアップを隠す
    * クライアントが使う要素には、個別のコントローラに`js-chat`というクラス名を追加させる 
        * JavaScriptが要素を増やすのと同時に、CSSを使って要素を表示できるようにするため 

## ユーザーフォーム

* ユーザーフォームは、ユーザーが希望するチャット名を取り込む
    * ユーザー名はチェック不要
        * 現在のサーバーは接続されたユーザーという概念を持っていないため
        * 同じ名前を使う2人のユーザーが同時にオンラインになっている可能性もある
* コントローラはビューとしてDOMフォーム要素が必要
    * フォーム要素には少なくとも１つのテキスト入力が含まれていなければならない
* コントローラは、フォームがサブミットされたときに、このテキストフィールドからユーザー名を読み出す
    * フォームがサブミットされた時の動作
        * コントローラは`モデルオブジェクトのプロパティにユーザーを代入`する
            * これによりアプリケーションのその他の部分から参照可能にする
* 次に、イベントを生成する
    * アプリケーションのほかの部分が、新しいユーザーの参加に反応して処理を実行可能にするため

## ビューを設定する

* コンポーネントの視覚的表現であるDOM要素を割りあてる