# クラスを設計

## 日本語でクラスを書く

* 日本語でクラスを書く
    * よく眺めてみると名前は、姓と名に分けられる
    * 住所は、優美番号、都道府県、市町村、番地、建物などに分割可能
    * 住所は別のクラスにする
    * 連絡先として電話番号が必要
* クラスをもっと細かく分けることもできるがここではクラスは２つ
* ２つのクラスを繋げる
    * 会員クラスには会員番号を追加する
    * 住所クラスにも同じ会員番号を追加する

このように分析しながら必要なクラスを作成する

クラスはなるべく小さく作るのがいい

```text
会員クラス
{
    名前; //名前は姓と名に、
    住所;
    メールアドレス;
    パスワード;
}
```

## さらに分割してクラスを抽出

```text
会員クラス //住所は別クラスに分割
{
    会員番号;
    姓;
    名;
    メールアドレス;
    パスワード;
}

住所クラス
{
    会員番号; // ここに会員番号を追加して繋ぐ
    郵便番号;
    都道府県;
    市区町村;
    番地;
    建物;
    電話番号;
}
```

### 処理を追加する

* 会員クラス処理を追加する
* クラスはデータ(情報)とメソッド(処理)を組み合わせたもの
* 前の手順で会員クラスにデータを追加できた
* 次にメソッドを追加する
* 必要な操作を考えたときに書き出した以下を追加する
    * 会員情報の登録
    * 登録完了メールの送信
    * 会員情報の編集
    * パスワードの再発行
    * 退会処理

```text
会員クラス  //住所は別クラスに分割
{
    会員番号;
    姓;
    名;
    メールアドレス;
    パスワード;

    会員情報の登録()
    会員情報の編集()
    パスワードの再発行()
    退会処理()
}
```

## PHPの記法で書き直す

* 日本語を英語にする
* データはクラスの内部で処理したいのでアクセス制限のキーワードの「private」を指定して、外部からアクセスできないようにする
* メソッドは全てクラスの外から実行したい
    * そのため`public`にする
* 各メソッドはよく眺めてみると色々不足している
    * 会員情報の登録を、どこに登録するのか
    * 登録時の画面はどうやって表示するのか
    * 登録データの安全性をどのようにチェックするのかetc
    * このような疑問や思いつきはTODOリストとしてコード内に記しておく
    * これらメソッド内の処理や不足分は後々実装する

```text
class Member
{
    private $id;
    private $lastname;
    private $firstname;
    private $email;
    private $password;
    
    public function regist()         // 会員情報の登録
    public function registMail()     // 登録完了メールの送信
    public function edit()           // 会員情報の編集
    public function resendPassword() // パスワードの再発行
    public function delete()         // 退会処理
}
```

### クラス内の定数

* クラスの中でも、値を変更できない「定数」を定義可能
* `define`関数の代わりに`const`キーワードを使用
    * `const 定数名 = 値;`のようにする
* 変数に付く`$`は不要
* クラス内で参照する場合は`self`キーワードと`::`演算子を使って、`self::定数名`とする
* インスタンスを表す`$this`は使用せず、クラス自身を表す`self`を使用する

```text
class Member
{
    const AdultAge = 20;

    function printAdultAge()
    {
        echo self::AdultAge;
    }
}
```

### アクセサー

* クラス内のprivate変数にアクセスするためのメソッド(アクセサー)を追加する
* ここではひとつのデータに対して、「データを設定する」メソッドと「データを取得するメソッド」を追加する
* データを設定するにはメソッドには`set`＋`変数名`のようにする
* データを取得するメソッドは`get`＋`変数名`とする
* あまりアクセサーが多いとわかりづらくなる
    * ここではわかりやすさを率先して、全ての変数に対して実装する
* [Member.php](Member.php)

### データの設定と取得

* Memberクラスを使って実際にデータを設定する
* `new`キーワードによりMemberクラスのインスタンスを生成する
* クラスという設計図から`$member`という実際にメモリ上で動作するオブジェクトを作成
* `setID()`に`1`を引数に与えて会員番号を設定する
* 姓、名、メールアドレス、パスワードもそれぞれのメソッドで設定する
* `getID()`でIDを取得して表示する
* その他の変数も同様にデータを取得して、表示する

```text
class Member
{
// ~ 省略 ~

    $member = new Member;
    $member->setID("1");
    $member->setLastname('あなたの姓');
    $member->setFirstname('あなたの名');
    $member->setEmail('あなたのメールアドレス');
    $member->setPassword('パスワード');

    print $member->getID()        . "<br>";
    print $member->getLastname()  . "<br>";
    print $member->getFirstname() . "<br>";
    print $member->getEmail()     . "<br>";
    print $member->getPassword()  . "<br>";
```

### 設計をバカにすることなかれ

* 設計で重要なのは、システムの品質をきちんと理解するということ
* **品質は作り込むもの**
    * テストをする前から品質は決定していることを意味する
    * プログラミングや設計の段階で、システムの品質は決定している
    * 設計ができる人はプログラムもきれいに書くことができる
    * その意味ではリファクタリングはプログラミング手法の一つと考えられがちだが、実は設計手法の１つと考えることも可能
