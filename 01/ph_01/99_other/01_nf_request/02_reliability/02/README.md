# 障害許容性

* 障害が発生してもシステム全体がダウンせずに動き続ける特性
    * `FT`としても知られている
        * `FT`: フォールトトレランス
* 障害が発生しても動き続けるには、2重化や多重化といったシステムの冗長化をするのが定石
    * ハードウェアでも、HDが破損するとデータが失われる
        * 複数台のHDを仮想的に1台に見せるようにRAID構成にする
        * RAID構成にすることで、HDが1台破損しても、もう1台に同じデータが書き込まれている
        * 破損時にデータが失われることがない
* 同じような考え方で、ソフトウェアでもサーバーを冗長化構成にする方法もある
    * WebサーバーやWebアプリケーションサーバーを同じ構成で複数台設置する

## サーバーの冗長化構成

![reliability](image/reliability_00.png)

* 冗長化したシステムに、クライアントからは冗長化していることを意識せずに接続したい
* 複数台の冗長化したサーバー群を1台のサーバーに見せる
    * 方法1
        * `ロードバランサを配置してクラスタリングする`
    * 方法2
        * 冗長化したサーバー群でセッションを維持する

### セッションの維持の問題

* HttpSessionなどのクライアントからの処理の状態をサーバーが保持する場合に問題になる
    * 例えば、WebアプリケーションサーバーをサーバーＡとサーバーＢの2台に冗長化している場合
    * そして、クライアントからアクセスがあり、ロードバランサによってサーバーＡに処理が振られたとする
    * 次に、同じクライアントからアクセスがあり、今度はロードバランサによってサーバーＢに振られたとする
    * この時、サーバーＡで処理をしたHttpSessionの情報は、サーバーＢに引き継がれない
    * サーバーＡでログインをして、ログイン状態をHttpSessionに格納している場合には、サーバーＢで再度ログインすることになる

セッションの維持は以下の解決策を取る

* [セッションスティッキー](https://github.com/aki-creatist/upstream/tree/master/ph_04/01_program/01_view/04/01)
* [セッション共有](https://github.com/aki-creatist/upstream/tree/master/ph_04/01_program/01_view/04/02)

一般的に、冗長化およびクラスタリングをすることで、信頼性だけでなく、負荷分散による時間挙動（性能やパフォーマンス）の向上も図れる
