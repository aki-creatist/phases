# ②基本設計時

## ゴール

* 機能動作イメージから行う性能机上計算
* 必要性能の把握
* 機能配置、並びに処理内容を決める
    * 機能配置: システムアーキテクチャとアプリケーションがどこで何をするか
    
## 背景

* DBのパフォーマンスのチューニング方法はDB製品によって異なる
    * 同じDB製品でもバージョンによって違う
    * DB製品の実装をある程度わかってSQLを書かないとパフォーマンスに差が出る

## 前提条件

* DB製品の種類とバージョンが確定していること

## 手順

### 機能動作イメージから行う性能机上計算

* 業務諸元から認識した`ピーク`について計算をする
    * `ここだけは重くなる`という処理を選ぶ
* アクセスするデータからSQLの発行数を数えて発行SQL数を決める
    * この機能はセレクト１回とインサート３回
    * １トランザクションで合計４回の SQLを発行するetc,,
* 時間当たりの件数を乗じる
    * DBに対して１秒間で何アクセス
    * その内訳がセレクト何回、インサート何回か
* TPCから情報を得る
    * システム全体の総合的な性能は、データベースの速度などを直接的に測っても意味がない
    * モデルとなる業務アプリケーションを動かした時に、この製品ではどれくらいの性能が出たということをメーカー間でベンチマークして競い合っている

## 対象    

* 計算を行うのは、以下のサーバに絞る
    * アプリケーションサーバ
    * データベースサーバ
* 項目は以下
    * CPU性能
    * ディスクのI/O性能

## 必要性能の把握

* 業務処理の特性と件数などの必要性能を把握する
    * Web画面からの発注処理など
    * どれくらいのサーバーが必要かというのは予測することができる
    * 具体的な処理の内容は確定していなくてもよい

## TPCから情報を得る

* `TPC`
    * `Transaction Processing Performance Council`
    * トランザクション処理性能評議会
        * 様々な業務モデルのベンチマークを行っている
    * 業務モデルが単純な分、データベースの基本的な性能の参考になる
    * ベンチマークデータには、１分あたりのトランザクション処理数が性能値として示されている
       * 性能計測するにあたっての処理内容も規定されている

### TPC-C

* 受注業務をモデルにしている
* Webアプリケーションで必要項目を入力してDBに値を入れていく
* システムの性能の参考になる
* DBにおける１分間のSQL処理能力の参考にもなる

### TPC-D

* DWHによる意思決定支援のモデル
    * DWHは業務要件によってデータ構造の複雑度が千差万別
    * そのものずばりの構成がないと利用は難しい

## TPCの注意点

* TPCの結果などはその条件に特化してチューニングされている
    * 将来の拡張性なども犠牲にしたギリギリの性能
* 公表されているベンチマーク性能の３分の１程度を目安に参考にする
    * ３分の１にすると、ほぼ実用上の拡張性やデータの増加などを考慮した場合に出る性能になる

## 簡単なテストを作る

* 簡単なテストシステムを作る
* SQLの基礎性能を取得して机上計算で使用する基礎性能値に使う
* Webで発表されているベンチマーク結果と自分が行った机上計算を比較
* 得られた結果を両面から評価する
